# FE Project Template

File Descriptions


| folder    | subfolder | filename| generated by? |  description |
| -------- | ---------- | --- | ------------- | ------------- |
| -|- | site_setup.py | built-in | actual script that is executed to generate input files ("setup_climate" or "setup_migration"), run simulations ("burnin" or "pickup") and analyze outputs ("calibrate") | 
|- | -| manifest.py | built-in | helper for setting input/output/experiment paths| 
|- |- | utils_slurm.py | built-in | helper for buld_burnin_df used to serialize simulations. | 
| simulation_inputs/ | - | demographics.csv | user | Describes location of site(s) to include in simulations. Required to generate climate or migration files before running any simulations.<br> Columns: node_id, pop, lat, lon <br> Be very careful adding new columns, as the `to_csv()` function of emodpi-api demographics may automatically recognize them as parameters |
|- |- | generate_climate.py | built-in | Creates weather files for nodes in `demographics.csv` over a specified date range, with options for<br>- constant temperature<br>- shifted rainfall.<br> Stores files in simulation_inputs/\<site_name>/climate/\<DateRange>/\<RainShift_Temperature>/|
| simulation_inputs/ | climate/   | ... | site_setup: step = 'setup_climate' | Subfolders containing weather files created by `generate_climate.py` during the "setup_climate" step. Each will be named according to <site_name>/\<DateRange>/\<RainShift_Temperature>|
|- |- | generate_migration_files.py | built-in | For multi-node simulations, builds migration binary files from input .csv files that exist in simulation_inputs/migration/ for the migration types listed in the migration_files dictionary within the "OPTIONS" block of `site_setup.py`|
| simulation_inputs/ | migration/ | ..._migration.csv | user  | Input spreadsheet describing migration between nodes in spatial simulations. Ex. local_migration.csv, vector_local_migration.csv, etc. <br> Columns are FromNode, ToNode, Rate **without headers** |
| simulation_inputs/ | migration/ | ..._migration.bin | site_setup: step = 'setup_migration'  | Migration binary files created by `generate_migration_files.py` during the "setup_migration" step. Each will match the corresponding name and migration type based on the input .csv files (above) and the migration_files dictionary in the "OPTIONS" block of `site_setup.py` |
| simulation_inputs/ | - | interventions_CM.csv | user | input file to setup Case Management via `add_treatment_seeking`.<br>Columns: node_id, phase, start_day, duration, trigger, age_min, age_max, coverage, seek, rate, drug, year |
| simulation_inputs/ | - | interventions_SMC.csv | user | input to setup Seasonal Malaria Chemoprevention via `add_drug_campaign` with drug-code 'SPA'.<br>Columns: node_id, phase, year, round, start_day, coverage|
| simulation_inputs/ | - | interventions_IRS.csv | user | input file to setup Indoor Residual Spraying via `scheduled_IRSHousingModification`.<br>Columns: node_id, phase,year, start_day, coverage, kill_effect, kill_duration, kill_decay, repel_effect, repel_duration, repel_decay, insecticide_name|
| simulation_inputs/ | - | interventions_ITN.csv | user | input file 1/3 to setup distribution of insecticide-treated bednets via `scheduled_usageDependentBednet`.<br>Columns: node_id,	phase,	year	start_day,	kill_effect,	kill_decay,	block_effect,	block_decay,	discard_k,	discard_l,	coverage|
| simulation_inputs/ | - | interventions_ITN_age.csv | user | input file 2/3 to setup distribution of insecticide-treated bednets via `scheduled_usageDependentBednet`.<br>Columns: node_id,	phase,	year,	age,	age_usage | 
| simulation_inputs/ | - | interventions_ITN_season.csv | user | input file 3/3 to setup distribution of insecticide-treated bednets via `scheduled_usageDependentBednet`.<br>Columns: node_id,	season_time,	season_usage | 


Basic instructions:

1. Create a folder within simulation_inputs for a new site (ex. "sapone")
2. Create a new demographics.csv for your site(s)/node(s)
3. Run site_setup.py with step = 'setup_climate' to create a folder with climate files specifying:
     - date range to request from COMPS
     - Constant temperature value (optional)
     - rainfall shift (optional)
4. Populate other input files with information relevant to your site simulations:
     - vectors.csv - for vector species mix and parameters

       *Interventions, if applicable:*
     - interventions_CM.csv - For treatment-seeking / case management
     - interventions_SMC.csv - For seasonal chemoproprevention 
     - interventions_IRS.csv - For indoor residual spraying
     - interventions_ITN.csv - For usage-dependent bednet distributions, also include:
         - interventions_ITN_age.csv     - age pattern of net usage
         - interventions_ITN_season.csv  - seasonal pattern of net usage
       
       *Migration, if applicable:*
    - local_migration.csv - for local human migration between nodes
    - vector_local_migration.csv - for local vector migration between nodes
      
      4a. Run site_setup.py with step = 'setup_migration' to create migration binary files for spatial simulations
5. Configure the habitat space you would like to sweep over. In the "OPTIONS" block of site_setup.py, select a list of values for:  
     - scale_temp_rain
     - scale_water_veg
     - scale_constant (usually left as [1.0])
     - xTLH 
6. Run site_setup.py with step = 'burnin'. Copy experiment-id to burnin_id
7. Run site_setup.py with step = 'pickup'. Copy experiment-id to pickup_id
8. Run site_setup.py with step = 'calibrate' or 'analyze_pickup'. Results will be stored in simulation_outputs/site_name/exp_label
9. **For now** use plot_site_setup.Rmd to visualize outputs
